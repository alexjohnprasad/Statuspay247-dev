<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Join StatusPay 247 as a Poster and start earning by sharing WhatsApp status ads.">
    <meta name="keywords" content="Join, Poster, WhatsApp, Status, Ads, Earn Money">
    <meta name="author" content="StatusPay 247">
    <title>Join as Poster - StatusPay 247</title>
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link rel="apple-touch-icon" href="assets/favicon.png">
    <link rel="shortcut icon" href="assets/favicon.png">
    <link rel="stylesheet" href="css/styles-cleaned.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="js/main.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Styling for the login card - updated to match homepage style */
        .existing-poster-login {
            margin-bottom: 3rem;
        }
        
        .login-card {
            background: linear-gradient(135deg, #3f8a69 0%, #62c196 100%); /* Changed to green color scheme to match brand */
            border-radius: 8px; /* Matching homepage border radius */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .login-card-content {
            padding: 2.5rem;
            position: relative;
            text-align: center;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .login-card h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
            font-family: 'Nunito', sans-serif; /* Match homepage font */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            display: inline-block;
        }
        
        .login-card h3::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background-color: #fff;
            border-radius: 3px;
        }
        
        .login-card p {
            margin-bottom: 1.8rem;
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
            opacity: 0.9;
            font-family: 'Nunito', sans-serif; /* Match homepage font */
        }
        
        .login-btn {
            background-color: #fff !important;
            color: #3f8a69 !important; /* Match button to card background */
            font-weight: 700 !important;
            padding: 0.9rem 2rem !important;
            border-radius: 50px !important;
            border: 2px solid transparent !important;
            display: inline-flex !important;
            align-items: center !important;
            font-family: 'Nunito', sans-serif !important; /* Match homepage font */
            transition: all 0.3s ease !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
        }
        
        .login-btn:hover {
            background-color: transparent !important;
            border-color: #fff !important;
            color: #fff !important;
            transform: translateY(-3px) !important;
        }
        
        .login-btn::before {
            content: "â†’";
            margin-right: 0;
            opacity: 0;
            width: 0;
            transition: all 0.3s ease;
        }
        
        .login-btn:hover::before {
            margin-right: 10px;
            opacity: 1;
            width: auto;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .login-card-content {
                padding: 2rem 1.5rem;
            }
            
            .login-card p {
                max-width: 100%;
            }
        }
        
        /* Other existing styles */
        .contact-field-hp {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            height: 0;
            width: 0;
            z-index: -1;
        }

        /* Add this to your existing <style> block */
        .password-input-container {
            position: relative;
        }
        
        .password-input-container input {
            padding-right: 35px; /* Make space for the eye icon */
        }
        
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #777;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <a href="/">
                        <img src="assets/logo.png" alt="StatusPay 247 Logo">
                    </a>
                </div>
                <div class="burger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul>
                    <li><a href="index.html#hero">Home</a></li>
                    <li><a href="index.html#what-is-statuspay">About</a></li>
                    <li><a href="index.html#how-it-works">How It Works</a></li>
                    <li><a href="index.html#why-choose-us">Why Choose Us</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <li><a href="poster.html">Join as Poster</a></li>
                    <li><a href="advertiser-terms.html">Advertisers</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="join-poster" class="section-light">
            <div class="container">
                <div class="section-title">
                    <h2>Join as a Poster</h2>
                </div>

                <!-- New login card for existing posters -->
                <div class="existing-poster-login">
                    <div class="login-card">
                        <div class="login-card-content">
                            <h3>Already a Poster?</h3>
                            <p>Access your account dashboard, track your earnings, view your tasks, and manage your payments all in one place.</p>
                            <a href="login.html" class="btn login-btn">Login to Your Account</a>
                        </div>
                    </div>
                </div>

                <div class="section-content">
                    <p>Fill out the form below to join StatusPay 247 as a poster and start earning by sharing WhatsApp status ads.</p>
                </div>
                <form id="posterForm" class="form" action="https://docs.google.com/forms/d/e/1FAIpQLSelLUo3QdkFAeyL1Dr40hHgvxOT0DGalDIuJx-Gg1e6BZ-bYg/formResponse" method="post">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="entry.644990948" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" 
                               id="email" 
                               name="entry.365909208" 
                               placeholder="Enter your Gmail address" 
                               required 
                               pattern="[a-zA-Z0-9._%+-]+@gmail\.com$" 
                               title="Please enter a valid Gmail address (example@gmail.com)">
                        <span id="email-error" class="error-message" style="display:none; color:red; font-size:0.9rem; margin-top:5px;">Only Gmail addresses are allowed (example@gmail.com)</span>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <div class="radio-group" style="display: flex; flex-wrap: nowrap; gap: 20px; margin-top: 8px; flex-direction: row;">
                            <label style="font-weight: normal; display: flex; align-items: center; white-space: nowrap;">
                                <input type="radio" id="genderMale" name="entry.1147565774" value="Male" required> 
                                <span style="margin-left: 8px;">Male</span>
                            </label>
                            <label style="font-weight: normal; display: flex; align-items: center; white-space: nowrap;">
                                <input type="radio" id="genderFemale" name="entry.1147565774" value="Female" required> 
                                <span style="margin-left: 8px;">Female</span>
                            </label>
                            <label style="font-weight: normal; display: flex; align-items: center; white-space: nowrap;">
                                <input type="radio" id="genderPreferNotToSay" name="entry.1147565774" value="Prefer not to say" required> 
                                <span style="margin-left: 8px;">Prefer not to say</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="whatsapp">WhatsApp Number</label>
                        <input type="tel" 
                               id="whatsapp" 
                               name="entry.1384481799" 
                               placeholder="Enter your WhatsApp number (10 digits)" 
                               required 
                               pattern="^(\+91)?[6-9][0-9]{9}$"
                               title="Please enter a valid Indian mobile number">
                        <span id="phone-error" class="error-message" style="display:none; color:red; font-size:0.9rem; margin-top:5px;">Only Indian WhatsApp numbers are allowed</span>
                    </div>
                    <div class="form-group">
                        <label for="street">Street Address</label>
                        <input type="text" id="street" name="entry.1784027061" placeholder="Enter your street address" required>
                    </div>
                    <div class="form-group">
                        <label for="city">City / Town</label>
                        <select id="city" name="entry.1641803405" required onchange="handleCityChange()">
                            <option value="">Select City / Town</option>
                            <option value="Thiruvananthapuram">Thiruvananthapuram</option>
                            <option value="Kozhikode">Kozhikode</option>
                            <option value="Kochi">Kochi</option>
                            <option value="Kollam">Kollam</option>
                            <option value="Thrissur">Thrissur</option>
                            <option value="Kannur">Kannur</option>
                            <option value="Alappuzha">Alappuzha</option>
                            <option value="Kottayam">Kottayam</option>
                            <option value="Palakkad">Palakkad</option>
                            <option value="Manjeri">Manjeri</option>
                            <option value="Thalassery">Thalassery</option>
                            <option value="Thrippunithura">Thrippunithura</option>
                            <option value="Ponnani">Ponnani</option>
                            <option value="Vatakara">Vatakara</option>
                            <option value="Kanhangad">Kanhangad</option>
                            <option value="Payyanur">Payyanur</option>
                            <option value="Koyilandy">Koyilandy</option>
                            <option value="Parappanangadi">Parappanangadi</option>
                            <option value="Kalamassery">Kalamassery</option>
                            <option value="Kodungallur">Kodungallur</option>
                            <option value="Neyyattinkara">Neyyattinkara</option>
                            <option value="Tanur">Tanur</option>
                            <option value="Kayamkulam">Kayamkulam</option>
                            <option value="Malappuram">Malappuram</option>
                            <option value="Guruvayur">Guruvayur</option>
                            <option value="Thrikkakkara">Thrikkakkara</option>
                            <option value="Irinjalakuda">Irinjalakuda</option>
                            <option value="Wadakkancherry">Wadakkancherry</option>
                            <option value="Nedumangad">Nedumangad</option>
                            <option value="Kondotty">Kondotty</option>
                            <option value="Tirurangadi">Tirurangadi</option>
                            <option value="Tirur">Tirur</option>
                            <option value="Panoor">Panoor</option>
                            <option value="Kasaragod">Kasaragod</option>
                            <option value="Feroke">Feroke</option>
                            <option value="Kunnamkulam">Kunnamkulam</option>
                            <option value="Ottappalam">Ottappalam</option>
                            <option value="Thiruvalla">Thiruvalla</option>
                            <option value="Thodupuzha">Thodupuzha</option>
                            <option value="Perinthalmanna">Perinthalmanna</option>
                            <option value="Karunagappalli">Karunagappalli</option>
                            <option value="Chalakudy">Chalakudy</option>
                            <option value="Payyoli">Payyoli</option>
                            <option value="Koduvally">Koduvally</option>
                            <option value="Mananthavady">Mananthavady</option>
                            <option value="Changanassery">Changanassery</option>
                            <option value="Mattanur">Mattanur</option>
                            <option value="Punalur">Punalur</option>
                            <option value="Nilambur">Nilambur</option>
                            <option value="Cherthala">Cherthala</option>
                            <option value="Sultan Bathery">Sultan Bathery</option>
                            <option value="Maradu">Maradu</option>
                            <option value="Kottakkal">Kottakkal</option>
                            <option value="Taliparamba">Taliparamba</option>
                            <option value="Shornur">Shornur</option>
                            <option value="Pandalam">Pandalam</option>
                            <option value="Kattappana">Kattappana</option>
                            <option value="Cherpulassery">Cherpulassery</option>
                            <option value="Mukkam">Mukkam</option>
                            <option value="Iritty">Iritty</option>
                            <option value="Valanchery">Valanchery</option>
                            <option value="Varkala">Varkala</option>
                            <option value="Nileshwaram">Nileshwaram</option>
                            <option value="Chavakkad">Chavakkad</option>
                            <option value="Kothamangalam">Kothamangalam</option>
                            <option value="Pathanamthitta">Pathanamthitta</option>
                            <option value="Attingal">Attingal</option>
                            <option value="Paravur">Paravur</option>
                            <option value="Ramanattukara">Ramanattukara</option>
                            <option value="Mannarkkad">Mannarkkad</option>
                            <option value="Erattupetta">Erattupetta</option>
                            <option value="Sreekandapuram">Sreekandapuram</option>
                            <option value="Angamaly">Angamaly</option>
                            <option value="Chittur-Thathamangalam">Chittur-Thathamangalam</option>
                            <option value="Kalpetta">Kalpetta</option>
                            <option value="North Paravur">North Paravur</option>
                            <option value="Haripad">Haripad</option>
                            <option value="Muvattupuzha">Muvattupuzha</option>
                            <option value="Kottarakara">Kottarakara</option>
                            <option value="Kuthuparamba">Kuthuparamba</option>
                            <option value="Adoor">Adoor</option>
                            <option value="Pattambi">Pattambi</option>
                            <option value="Anthoor">Anthoor</option>
                            <option value="Perumbavoor">Perumbavoor</option>
                            <option value="Piravom">Piravom</option>
                            <option value="Ettumanoor">Ettumanoor</option>
                            <option value="Mavelikkara">Mavelikkara</option>
                            <option value="Eloor">Eloor</option>
                            <option value="Chengannur">Chengannur</option>
                            <option value="Vaikom">Vaikom</option>
                            <option value="Aluva">Aluva</option>
                            <option value="Pala">Pala</option>
                            <option value="Koothattukulam">Koothattukulam</option>
                            <option value="Other">Other (not listed)</option>
                        </select>
                        <div id="otherCityContainer" style="display: none; margin-top: 8px;">
                            <input type="text" id="otherCity" placeholder="Please specify your city/town" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="district">District</label>
                        <select id="district" name="entry.1463138286" required onchange="handleDistrictChange()">
                            <option value="">Select District</option>
                            <option value="Alappuzha">Alappuzha</option>
                            <option value="Ernakulam">Ernakulam</option>
                            <option value="Idukki">Idukki</option>
                            <option value="Kannur">Kannur</option>
                            <option value="Kasaragod">Kasaragod</option>
                            <option value="Kollam">Kollam</option>
                            <option value="Kottayam">Kottayam</option>
                            <option value="Kozhikode">Kozhikode</option>
                            <option value="Malappuram">Malappuram</option>
                            <option value="Palakkad">Palakkad</option>
                            <option value="Pathanamthitta">Pathanamthitta</option>
                            <option value="Thiruvananthapuram">Thiruvananthapuram</option>
                            <option value="Thrissur">Thrissur</option>
                            <option value="Wayanad">Wayanad</option>
                            <option value="Other">Other (not listed)</option>
                        </select>
                        <div id="otherDistrictContainer" style="display: none; margin-top: 8px;">
                            <input type="text" id="otherDistrict" placeholder="Please specify your district" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <input type="text" id="state" name="entry.327284084" value="Kerala" required>
                    </div>
                    <div class="form-group">
                        <label for="pincode">Postal Code</label>
                        <input type="text" id="pincode" name="entry.949189106" placeholder="Enter your postal code" required pattern="\d{6}" title="Please enter a valid 6-digit postal code" oninput="getLocation()">
                    </div>
                    <div class="form-group">
                        <label for="country">Country</label>
                        <input type="text" id="country" name="entry.2012686887" value="India" required>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob" name="entry.2125844010" required onchange="validateAge(this)">
                        <span id="age-error" class="error-message" style="display:none; color:red; font-size:0.9rem; margin-top:5px;">You must be at least 18 years old to register.</span>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <div class="password-input-container">
                            <input type="password" id="password" name="entry.598604780" placeholder="Create a strong password" required>
                            <span class="password-toggle" onclick="togglePasswordVisibility('password')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div class="password-input-container">
                            <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
                            <span class="password-toggle" onclick="togglePasswordVisibility('confirmPassword')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                    </div>

                    <!-- Honeypot field -->
                    <div class="form-group contact-field-hp" aria-hidden="true">
                        <label for="contact-email">Email</label>
                        <input type="text" id="contact-email" name="contact-email" autocomplete="off" tabindex="-1">
                    </div>

                    <div class="captcha-container" style="margin: 20px 0;">
                        <div class="math-challenge" style="display: flex; align-items: center; gap: 8px;">
                            <span id="num1">5</span>
                            <span>+</span>
                            <span id="num2">3</span>
                            <span>=</span>
                            <input type="number" id="captcha-answer" min="0" max="20" required style="width: 60px;">
                            <button type="button" class="captcha-reset" onclick="generateCaptcha()" title="Get New Challenge" style="padding: 6px 10px;">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                    </div>

                    <div class="terms-disclaimer">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="terms-accept" required>
                            <label for="terms-accept">
                                I have read and agree to the <a href="terms-and-conditions-for-posters.html" target="_blank">Terms and Conditions</a>
                            </label>
                        </div>
                        <p class="disclaimer-text">Please carefully read our terms and conditions before proceeding. Your registration indicates acceptance of all terms.</p>
                        <input type="hidden" id="terms-accepted" name="entry.terms_acceptance" value="Terms and conditions not accepted">
                    </div>

                    <button type="submit" class="btn" id="submit-btn" disabled>Submit Application</button>
                </form>

                <script>
                    // Generate random CAPTCHA challenge
                    function generateCaptcha() {
                        const num1 = Math.floor(Math.random() * 10) + 1;
                        const num2 = Math.floor(Math.random() * 10) + 1;
                        document.getElementById("num1").textContent = num1;
                        document.getElementById("num2").textContent = num2;
                        document.getElementById("captcha-answer").value = "";
                        return { num1, num2 };
                    }

                    // Initialize CAPTCHA on page load
                    let currentCaptcha = generateCaptcha();

                    // Add hash function using SHA-256
                    async function hashPassword(password) {
                        const encoder = new TextEncoder();
                        const data = encoder.encode(password);
                        const hash = await crypto.subtle.digest('SHA-256', data);
                        return Array.from(new Uint8Array(hash))
                            .map(b => b.toString(16).padStart(2, '0'))
                            .join('');
                    }

                    // Improved age validation function
                    function validateAge(dobInput) {
                        const dob = new Date(dobInput.value);
                        const today = new Date();
                        
                        // Calculate age with milliseconds for more accuracy
                        const ageTime = today.getTime() - dob.getTime();
                        const ageDate = new Date(ageTime);
                        const age = Math.abs(ageDate.getUTCFullYear() - 1970);
                        
                        const ageError = document.getElementById("age-error");
                        const submitBtn = document.getElementById("submit-btn");
                        const termsAccepted = document.getElementById("terms-accept").checked;
                        
                        console.log("Age calculated:", age, "DOB:", dobInput.value);
                        
                        if (age < 18) {
                            ageError.style.display = "block";
                            dobInput.setCustomValidity("You must be at least 18 years old to register.");
                            submitBtn.disabled = true;
                            return false;
                        } else {
                            ageError.style.display = "none";
                            dobInput.setCustomValidity("");
                            submitBtn.disabled = !termsAccepted;
                            return true;
                        }
                    }

                    // Set the max date to exactly 18 years ago and update it daily
                    window.addEventListener('DOMContentLoaded', function() {
                        const dobInput = document.getElementById('dob');
                        const today = new Date();
                        
                        // Calculate date 18 years ago from today
                        const minYear = today.getFullYear() - 18;
                        const minMonth = today.getMonth();
                        const minDay = today.getDate();
                        
                        // Format as YYYY-MM-DD with leading zeros
                        const formattedMonth = (minMonth + 1).toString().padStart(2, '0');
                        const formattedDay = minDay.toString().padStart(2, '0');
                        const maxDate = `${minYear}-${formattedMonth}-${formattedDay}`;
                        
                        // Set max attribute - this prevents selection of dates after this (younger than 18)
                        dobInput.setAttribute('max', maxDate);
                        
                        console.log("Max date set to:", maxDate, "(updates daily)");
                        
                        // Add event listener to prevent manual entry of invalid dates
                        dobInput.addEventListener('input', function(e) {
                            const selectedDate = new Date(this.value);
                            const minDate = new Date(minYear, minMonth, minDay);
                            
                            if (selectedDate > minDate) {
                                this.value = maxDate;
                                alert("You must be at least 18 years old to register.");
                            }
                        });
                    });

                    // Add strong Gmail validation
                    document.getElementById("email").addEventListener('input', function() {
                        const email = this.value.toLowerCase();
                        const emailError = document.getElementById("email-error");
                        const emailPattern = /[a-zA-Z0-9._%+-]+@gmail\.com$/;
                        
                        if (email && !emailPattern.test(email)) {
                            emailError.style.display = "block";
                            this.setCustomValidity("Only Gmail addresses are allowed (example@gmail.com)");
                        } else {
                            emailError.style.display = "none";
                            this.setCustomValidity("");
                        }
                    });

                    // Ensure age is validated when form is submitted
                    document.getElementById("posterForm").addEventListener("submit", async function(event) {
                        event.preventDefault(); // Prevent default form submission
                        
                        // Check if email is Gmail
                        const email = document.getElementById("email").value.toLowerCase();
                        if (!email.endsWith('@gmail.com')) {
                            document.getElementById("email-error").style.display = "block";
                            document.getElementById("email").focus();
                            return; // Stop submission if not Gmail
                        }
                        
                        // Check age first
                        const dobInput = document.getElementById("dob");
                        if (dobInput.value && !validateAge(dobInput)) {
                            dobInput.focus();
                            return; // Stop submission if age check fails
                        }
                        
                        // Check terms acceptance
                        if (!document.getElementById("terms-accept").checked) {
                            alert("Please accept the terms and conditions.");
                            return; // Stop submission if terms are not accepted
                        }
                        
                        const password = document.getElementById("password").value;
                        const phone = document.getElementById("whatsapp").value;

                        // Hash password before submission
                        try {
                            const hashedPassword = await hashPassword(password);
                            
                            // Create FormData and replace password with hash
                            const formData = new FormData(this);
                            formData.set('entry.598604780', hashedPassword);
                            
                            // Handle "Other" city and district
                            if (document.getElementById("city").value === "Other") {
                                formData.set('entry.1641803405', document.getElementById("otherCity").value);
                            }
                            
                            if (document.getElementById("district").value === "Other") {
                                formData.set('entry.1463138286', document.getElementById("otherDistrict").value);
                            }
                            
                            // Submit the form with fetch and disable button during submission
                            const submitBtn = document.getElementById("submit-btn");
                            submitBtn.disabled = true;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                            
                            let submitted = false;
                            
                            try {
                                // Submit to Google Forms
                                const googleFormUrl = "https://docs.google.com/forms/d/e/1FAIpQLSelLUo3QdkFAeyL1Dr40hHgvxOT0DGalDIuJx-Gg1e6BZ-bYg/formResponse";
                                const googleFormResponse = await fetch(googleFormUrl, {
                                    method: 'POST',
                                    body: formData,
                                    mode: 'no-cors'
                                });
                                
                                // Check if the Google Forms submission was successful (best effort)
                                if (googleFormResponse.status === 200 || googleFormResponse.type === 'opaque') {
                                    console.log('Google Forms submission appears successful');
                                    submitted = true;
                                } else {
                                    console.error('Google Forms submission failed:', googleFormResponse.status, googleFormResponse.statusText);
                                    alert("Google Forms submission failed. Please try again.");
                                    return; // Stop further processing
                                }
                                
                                // Also send verification request to Apps Script with the deployment ID for your script
                                const verifyUrl = 'https://script.google.com/macros/s/AKfycbwfiN714a3_7HnywNYAL1dzqpgp8ZL-gKsE1uUhRtM5gHa9c_SkSzQZjUlWuhqgS9PzOA/exec';
                                
                                // Start checking for verification after a delay
                                setTimeout(() => {
                                    checkSubmissionStatus(phone, email);
                                }, 3000); // Slightly longer delay to ensure form processing completes
                                
                                // Show immediate success popup
                                document.getElementById("success-popup").style.display = "flex";
                                
                                // Reset form fields and captcha
                                document.getElementById("posterForm").reset();
                                generateCaptcha();
                                handleCityChange();
                                handleDistrictChange();
                                
                                // Auto-fill phone number in popup
                                document.getElementById('popup-phone').value = phone;
                                
                            } catch (error) {
                                console.error("Form submission error:", error);
                                alert("An error occurred. Please try again.");
                            } finally {
                                submitBtn.disabled = false;
                                submitBtn.innerHTML = 'Submit Application';
                            }
                        } catch (error) {
                            console.error("Error during form preparation:", error);
                            alert("An error occurred preparing your submission. Please try again.");
                        }
                    });

                    // Add function to check submission status
                    function checkSubmissionStatus(phone, email) {
                        const verifyUrl = 'https://script.google.com/macros/s/AKfycbwfiN714a3_7HnywNYAL1dzqpgp8ZL-gKsE1uUhRtM5gHa9c_SkSzQZjUlWuhqgS9PzOA/exec';
                        
                        fetch(`${verifyUrl}?phone=${encodeURIComponent(phone)}&email=${encodeURIComponent(email)}&check=true`)
                        .then(response => {
                            // Handle no-cors mode or CORS issues
                            if (!response.ok && response.type !== 'opaque') {
                                throw new Error("Network response was not ok");
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data && data.verified) {
                                console.log("Submission verified in spreadsheet");
                                
                                // Update UI to show verified status
                                const popup = document.getElementById("success-popup");
                                if (popup) {
                                    // Check if verification message already exists to avoid duplicates
                                    if (!document.getElementById('verification-message')) {
                                        const verificationMsg = document.createElement("p");
                                        verificationMsg.id = 'verification-message';
                                        verificationMsg.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50; margin-right: 5px;"></i> Your registration has been verified!';
                                        verificationMsg.style.color = "#4CAF50";
                                        verificationMsg.style.fontWeight = "600";
                                        verificationMsg.style.marginTop = "15px";
                                        popup.querySelector(".popup-body").appendChild(verificationMsg);
                                    }
                                }
                            } else {
                                console.log("Submission not yet verified, retrying...");
                                // Try again after delay (but limit attempts to avoid infinite loop)
                                if (!window.verificationAttempts) window.verificationAttempts = 0;
                                window.verificationAttempts++;
                                
                                if (window.verificationAttempts < 5) { // Try up to 5 times
                                    setTimeout(() => checkSubmissionStatus(phone, email), 3000);
                                }
                            }
                        })
                        .catch(error => {
                            console.error("Error checking submission status:", error);
                        });
                    }

                    // Update terms handler to recheck age validation
                    document.getElementById("terms-accept").addEventListener("change", function(event) {
                        const submitButton = document.getElementById("submit-btn");
                        const dobInput = document.getElementById("dob");
                        
                        // If DOB is filled, validate age, otherwise just check terms
                        if (dobInput.value) {
                            validateAge(dobInput);
                        } else {
                            submitButton.disabled = !this.checked;
                        }

                        // Update the hidden field value with a full statement
                        const userName = document.getElementById("name").value || "[Applicant Name]";
                         
                        if (event.target.checked) {
                            const acceptanceStatement = "I, " + userName + ", hereby accept and agree to abide by all the terms and conditions of StatusPay 247 as outlined in the Terms and Conditions document. I understand that by submitting this application, I am entering into a binding agreement with StatusPay 247.";
                            document.getElementById("terms-accepted").value = acceptanceStatement;
                        } else {
                            document.getElementById("terms-accepted").value = "Terms and conditions not accepted";
                        }
                    });
                    
                    // Update acceptance statement when name changes
                    document.getElementById("name").addEventListener("input", function() {
                        if (document.getElementById("terms-accept").checked) {
                            const userName = this.value || "[Applicant Name]";
                            const acceptanceStatement = "I, " + userName + ", hereby accept and agree to abide by all the terms and conditions of StatusPay 247 as outlined in the Terms and Conditions document. I understand that by submitting this application, I am entering into a binding agreement with StatusPay 247.";
                            document.getElementById("terms-accepted").value = acceptanceStatement;
                        }
                    });

                    // Function to handle login from popup with multiple fallback methods
                    async function popupLogin() {
                        // Clean phone number and take last 10 digits to match server-side processing
                        const phone = document.getElementById('popup-phone').value.replace(/[^0-9]/g, "").slice(-10);
                        const password = document.getElementById('popup-password').value;
                        const loginBtn = document.getElementById('popup-login-btn');
                        
                        if (!phone || !password) {
                            alert('Please enter both phone number and password');
                            return;
                        }
                        
                        loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                        loginBtn.disabled = true;
                        
                        try {
                            // Hash the password (SHA-256)
                            const hashedPassword = await hashPassword(password);
                            console.log('Attempting login with phone:', phone);
                            console.log('Password hash length:', hashedPassword.length);
                            
                            // Get the Apps Script URL
                            const scriptId = 'AKfycbwfiN714a3_7HnywNYAL1dzqpgp8ZL-gKsE1uUhRtM5gHa9c_SkSzQZjUlWuhqgS9PzOA';
                            const apiUrl = 'https://script.google.com/macros/s/' + scriptId + '/exec';
                            
                            // Try multiple login methods in sequence
                            let loginResponse = null;
                            let errorMessages = [];
                            
                            // Method 1: Try direct fetch with JSON
                            try {
                                const fetchResponse = await fetch(apiUrl, {
                                    method: 'POST',
                                    mode: 'cors',
                                    cache: 'no-cache',
                                    headers: {
                                        'Content-Type': 'application/x-www-form-urlencoded'
                                    },
                                    body: new URLSearchParams({
                                        'action': 'login',
                                        'phone': phone,
                                        'password': hashedPassword
                                    })
                                });
                                
                                if (fetchResponse.ok) {
                                    loginResponse = await fetchResponse.json();
                                    console.log('Direct fetch successful:', loginResponse);
                                } else {
                                    errorMessages.push('Fetch failed with status: ' + fetchResponse.status);
                                }
                            } catch (fetchError) {
                                console.warn('Direct fetch error:', fetchError);
                                errorMessages.push('Fetch error: ' + fetchError.message);
                            }
                            
                            // Method 2: If direct fetch failed, try JSONP
                            if (!loginResponse) {
                                try {
                                    loginResponse = await new Promise((resolve, reject) => {
                                        const callbackName = 'loginCallback_' + new Date().getTime();
                                        
                                        // Set a timeout
                                        const timeoutId = setTimeout(function() {
                                            if (window[callbackName]) {
                                                delete window[callbackName];
                                                if (document.getElementById('jsonp-script')) {
                                                    document.body.removeChild(document.getElementById('jsonp-script'));
                                                }
                                                reject(new Error('JSONP request timed out'));
                                            }
                                        }, 20000); // 20 second timeout
                                        
                                        // Create the callback function
                                        window[callbackName] = function(response) {
                                            clearTimeout(timeoutId);
                                            if (document.getElementById('jsonp-script')) {
                                                document.body.removeChild(document.getElementById('jsonp-script'));
                                            }
                                            delete window[callbackName];
                                            
                                            if (response && response.success) {
                                                resolve(response);
                                            } else {
                                                reject(new Error(response ? response.message : 'Login failed'));
                                            }
                                        };
                                        
                                        // Create and append the script tag
                                        const script = document.createElement('script');
                                        script.id = 'jsonp-script';
                                        script.src = apiUrl + 
                                                    '?action=login' + 
                                                    '&phone=' + encodeURIComponent(phone) + 
                                                    '&password=' + encodeURIComponent(hashedPassword) + 
                                                    '&callback=' + callbackName + 
                                                    '&t=' + new Date().getTime();
                                        document.body.appendChild(script);
                                    });
                                    
                                    console.log('JSONP successful:', loginResponse);
                                } catch (jsonpError) {
                                    console.warn('JSONP error:', jsonpError);
                                    errorMessages.push('JSONP error: ' + jsonpError.message);
                                }
                            }
                            
                            // Method 3: If JSONP failed, try form submission in an iframe
                            if (!loginResponse) {
                                try {
                                    loginResponse = await new Promise((resolve, reject) => {
                                        // Create a hidden iframe
                                        const iframe = document.createElement('iframe');
                                        iframe.style.display = 'none';
                                        iframe.name = 'login-target-' + new Date().getTime();
                                        document.body.appendChild(iframe);
                                        
                                        // Create a form that targets the iframe
                                        const form = document.createElement('form');
                                        form.style.display = 'none';
                                        form.method = 'POST';
                                        form.action = apiUrl;
                                        form.target = iframe.name;
                                        
                                        // Add form fields
                                        const addField = (name, value) => {
                                            const input = document.createElement('input');
                                            input.type = 'hidden';
                                            input.name = name;
                                            input.value = value;
                                            form.appendChild(input);
                                        };
                                        
                                        addField('action', 'login');
                                        addField('phone', phone);
                                        addField('password', hashedPassword);
                                        
                                        document.body.appendChild(form);
                                        
                                        // Set a timeout
                                        const timeoutId = setTimeout(function() {
                                            document.body.removeChild(iframe);
                                            document.body.removeChild(form);
                                            reject(new Error('Form submission timed out'));
                                        }, 20000);
                                        
                                        // Listen for iframe load
                                        iframe.onload = function() {
                                            try {
                                                clearTimeout(timeoutId);
                                                
                                                // Try to read the response from the iframe
                                                // Note: This might fail due to same-origin policy
                                                const iframeContent = iframe.contentWindow.document.body.textContent;
                                                let response = null;
                                                
                                                try {
                                                    response = JSON.parse(iframeContent);
                                                } catch (parseError) {
                                                    console.warn('Failed to parse iframe response:', parseError);
                                                }
                                                
                                                document.body.removeChild(iframe);
                                                document.body.removeChild(form);
                                                
                                                if (response && response.success) {
                                                    resolve(response);
                                                } else {
                                                    reject(new Error('Form submission failed'));
                                                }
                                            } catch (error) {
                                                document.body.removeChild(iframe);
                                                document.body.removeChild(form);
                                                reject(error);
                                            }
                                        };
                                        
                                        // Submit the form
                                        form.submit();
                                    });
                                    
                                    console.log('Form submission successful:', loginResponse);
                                } catch (formError) {
                                    console.warn('Form submission error:', formError);
                                    errorMessages.push('Form submission error: ' + formError.message);
                                }
                            }
                            
                            // If we have a successful login response, handle it
                            if (loginResponse && loginResponse.success) {
                                // Store user info in localStorage
                                localStorage.setItem('user', JSON.stringify(loginResponse.user));
                                localStorage.setItem('loggedIn', 'true');
                                localStorage.setItem('loginTime', new Date().toString());
                                localStorage.setItem('userPhone', phone);
                                
                                // Show success message and redirect
                                alert('Login successful! Redirecting to dashboard...');
                                window.location.href = 'dashboard.html';
                            } else {
                                // All methods failed
                                throw new Error('All login methods failed: ' + errorMessages.join(', '));
                            }
                            
                        } catch (error) {
                            console.error('Login error:', error);
                            alert('Login failed: ' + (error.message || 'Unknown error'));
                        } finally {
                            // Reset the login button
                            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt" style="margin-right: 8px;"></i> Log In';
                            loginBtn.disabled = false;
                        }
                    }

                    // Add this to your existing <script> block
                    function togglePasswordVisibility(inputId) {
                        const passwordInput = document.getElementById(inputId);
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        
                        // Toggle the eye icon
                        const toggleIcon = document.querySelector(`#${inputId} + .password-toggle i`);
                        toggleIcon.classList.toggle('fa-eye');
                        toggleIcon.classList.toggle('fa-eye-slash');
                    }
                </script>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>StatusPay 247</h3>
                    <p>Your trusted platform for earning through WhatsApp status ads. Connect with us to start your earning journey today.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html#hero">Home</a></li>
                        <li><a href="index.html#what-is-statuspay">About</a></li>
                        <li><a href="index.html#how-it-works">How It Works</a></li>
                        <li><a href="index.html#why-choose-us">Why Choose Us</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                        <li><a href="poster.html">Join as Poster</a></li>
                        <li><a href="advertiser-terms.html">Advertisers</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <p>Follow us on social media for updates and tips.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/statuspay247" target="_blank"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.instagram.com/statuspay247" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="https://twitter.com/statuspay247" target="_blank"><i class="fab fa-twitter"></i></a>
                        <a href="https://wa.me/919744483058" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 StatusPay 247. All rights reserved.</p>
                <p class="disclaimer">WhatsAppÂ® is a registered trademark of Meta Platforms, Inc. We are not affiliated with or endorsed by WhatsAppÂ® or Meta Platforms, Inc. The services we provide involve direct WhatsApp status marketing using our network of users, and the use of the WhatsAppÂ® logo or name is strictly for illustrative purposes. All rights to WhatsAppÂ® remain the property of Meta Platforms, Inc.</p>
            </div>
        </div>
    </footer>

    <script>
        function getLocation() {
            const pinCode = document.getElementById("pincode").value;
            const currentPin = document.getElementById("pincode").value;

            if (pinCode.length >= 3) {
                const apiUrl = `https://api.zippopotam.us/in/${pinCode}`;

                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Invalid response from API");
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data && data.places && data.places.length > 0) {
                            const state = data.places[0]['state'] || "Unknown";
                            const country = data['country'] || "Unknown";

                            // Only suggest values, keep current postal code
                            document.getElementById("pincode").value = currentPin;
                            document.getElementById("state").value = state;
                            document.getElementById("country").value = country;
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching location data:", error);
                        // Keep existing values on error
                        document.getElementById("pincode").value = currentPin;
                    });
            }
        }
    </script>

    <!-- Success Popup -->
    <div id="success-popup" class="popup-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div class="popup-content" style="background: white; padding: 30px; border-radius: 8px; max-width: 450px; text-align: center;">
            <div class="popup-header" style="margin-bottom: 20px;">
                <h3 style="color: #4CAF50; margin: 0;">Registration Complete!</h3>
            </div>
            <div class="popup-body">
                <p style="margin-bottom: 20px; font-size: 1.1rem;">Your registration is completed. You can log in using your phone number and password.</p>
                
                <!-- Minimal login form -->
                <div class="minimal-login-form" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="popup-phone" style="display: block; margin-bottom: 5px; font-size: 0.9rem; font-weight: 600; text-align: left;">WhatsApp Number</label>
                        <input type="tel" id="popup-phone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; color: black;" placeholder="Enter your WhatsApp number">
                    </div>
                    
                    <div class="form-group">
                        <label for="popup-password" style="display: block; margin-bottom: 5px; font-size: 0.9rem; font-weight: 600; text-align: left;">Password</label>
                        <div class="password-input-container">
                            <input type="password" id="popup-password" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; color: black;" placeholder="Enter your password">
                            <span class="password-toggle" onclick="togglePasswordVisibility('popup-password')" style="color: black;">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                    </div>
                    
                    <button id="popup-login-btn" onclick="popupLogin()" class="btn" style="background: #4CAF50; color: white; padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-sign-in-alt" style="margin-right: 8px;"></i> Log In Now
                    </button>
                    
                    <p style="font-size: 0.8rem; color: #666; margin: 5px 0 0; text-align: center;">Having trouble? <a href="login.html" style="color: #4CAF50;">Go to login page</a></p>
                </div>
                
                <div style="display: flex; justify-content: center;">
                    <button onclick="document.getElementById('success-popup').style.display='none'" style="background: #f44336; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center;">
                        <i class="fas fa-times" style="margin-right: 8px;"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add this script at the end of the file, just before the closing </body> tag
        document.addEventListener('DOMContentLoaded', function() {
            // Prepopulate the form with the specified credentials
            const urlParams = new URLSearchParams(window.location.search);
            const autoFill = urlParams.get('autofill') || 'true'; // Default to true
            
            if (autoFill === 'true') {
                // Fill in the email and phone fields
                document.getElementById('name').value = 'Dummy Name';
                document.getElementById('email').value = 'alxjpdop@gmail.com';
                document.getElementById('whatsapp').value = '7736166218';
                document.getElementById('street').value = '123 Dummy Street';
                document.getElementById('city').value = 'Kochi';
                
                // Select gender
                document.getElementById('genderMale').checked = true;
                
                document.getElementById('district').value = 'Ernakulam';
                document.getElementById('state').value = 'Kerala';
                document.getElementById('pincode').value = '682001';
                document.getElementById('country').value = 'India';
                document.getElementById('dob').value = '2000-01-01';
                
                // Fill in the password fields
                document.getElementById('password').value = 'alex';
                document.getElementById('confirmPassword').value = 'alex';
                
                // Check "I agree to terms" checkbox
                document.getElementById('terms-accept').checked = true;
                
                // Trigger the change event on terms-accept to enable the submit button
                const termsEvent = new Event('change');
                document.getElementById('terms-accept').dispatchEvent(termsEvent);
                
                // Update the acceptance statement
                const userName = document.getElementById("name").value || "[Applicant Name]";
                const acceptanceStatement = "I, " + userName + ", hereby accept and agree to abide by all the terms and conditions of StatusPay 247 as outlined in the Terms and Conditions document. I understand that by submitting this application, I am entering into a binding agreement with StatusPay 247.";
                document.getElementById("terms-accepted").value = acceptanceStatement;
                
                console.log('Form prepopulated with test credentials');
            }
        });
    </script>
</body>
</html>
